---
import Block from '~/components/blocks/Block.astro';
import { Image } from 'astro:assets';
import Button from '~/components/ui/Button.astro';
import RandomLink from '~/components/ui/RandomLink.astro';
import product from '~/assets/work/mykringapp/product.png';

import portfolio from '~/data/work';

import { Icon } from 'astro-icon/components';
interface Props {
    wrapper?: string;
    gridHeight?: string;
}
const { wrapper, gridHeight } = Astro.props;
---

<Block
    layout={{ slots: 2, type: 'default' }}
    data-inview="portfolio"
    wrapperClass="bg-brand not-prose"
>
    <div class="plusheap absolute inset-0 h-full w-full opacity-20"></div>

    <div slot="s1" class="self-center" data-animate="scaleIn">
        <Image
            src={product}
            quality="high"
            loading="eager"
            densities={[1.5, 2]}
            width={600}
            class="relative m-0 h-full w-full object-contain"
            alt="iPhones with mykring app in use"
        />
    </div>
    <div slot="s2" class="self-center py-fl-space-m text-content-loud">
        <h2
            class="font-headline text-fl-step-3/tight font-bold tracking-tight"
            data-animate="fadeInDown"
        >
            Show and tell
        </h2>
        <p class="mb-fl-space-m" data-animate="fadeInDown">
            Curious to see my work in action? Discover the stories behind my
            projects, the challenges addressed, and the solutions crafted.
        </p>
        <p class="flex flex-row gap-fl-space-3xs">
            <Button data-animate="scaleIn" theme="secondary" href="/work/"
                >Explore the portfolio</Button
            >
            <RandomLink
                theme="disco"
                href="/work/"
                data-animate="scaleIn"
                isIcon={true}
                choices={portfolio.collection}
                >Random pick
                <Icon
                    name="lucide:shuffle"
                    class="h-fl-space-xs w-auto animate-pulse"
                />
            </RandomLink>
        </p>
    </div>
</Block>

<script>
    import { inView, timeline, type TimelineDefinition, stagger } from 'motion';

    const focus = document.querySelectorAll('[data-inview="portfolio"]');
    inView(
        focus,
        (info) => {
            const queryElementsByAnimation = (animation) => {
                return info.target.querySelectorAll(
                    `[data-animate="${animation}"]`,
                );
            };
            const scaleIn = queryElementsByAnimation('scaleIn');
            const fadeInDown = queryElementsByAnimation('fadeInDown');

            const sequence: TimelineDefinition = [
                [
                    fadeInDown,
                    {
                        opacity: [0, 1],
                        transform: ['translateY(-25%)', 'translateY(0%)'],
                    },
                    { duration: 0.25, delay: stagger(0.1) },
                ],
                [
                    scaleIn,
                    {
                        opacity: [0, 1],
                        scale: [0.85, 1],
                    },
                    { duration: 0.25, delay: stagger(0.25) },
                ],
            ];
            const animation = timeline(sequence, {});

            return (leaveInfo) => animation.reverse();
        },
        { amount: 0.25 },
    );
</script>
