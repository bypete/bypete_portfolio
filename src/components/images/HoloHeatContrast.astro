---
// 2-chromatic-breath.astro â€“ FIXED for TypeScript
import type { ImageMetadata } from 'astro';

export interface Props {
    visual: ImageMetadata;
    alt?: string;
    intensity?: number;
    speed?: number;
}

const { visual, alt = '', intensity = 7, speed = 5 } = Astro.props;
---

<div class="chromatic-breath relative h-full w-full overflow-hidden">
    <img
        src={visual.src}
        alt={alt}
        class="pointer-events-none absolute inset-0 h-full w-full object-cover select-none"
        loading="lazy"
    />
</div>

<script>
    import { inView, animate } from 'motion';

    document.querySelectorAll('.chromatic-breath').forEach((el) => {
        const container = el as HTMLElement;
        const i = Number(container.dataset.intensity ?? 7) / 10;
        const s = Number(container.dataset.speed ?? 5);

        inView(
            container,
            () => {
                animate([
                    [
                        container,
                        {
                            filter: [
                                'brightness(1.25) contrast(12.25) hue-rotate(0deg) saturate(1)',
                                `brightness(${1.12 + i * 0.02}) contrast(${1.08 + i * 0.01}) hue-rotate(${8 + i * 4}deg) saturate(${1.25 + i * 0.1})`,
                                // `brightness(${0.94 - i * 0.01}) contrast(${1.15 + i * 0.02}) hue-rotate(${-6 - i * 3}deg) saturate(${0.9 - i * 0.05})`,
                            ],
                        } as any,
                        {
                            duration: (22 / s) * 1,
                            repeat: 3,
                            ease: 'easeInOut',
                        },
                    ],
                ]);
            },
            { amount: 0.4 }
        );
    });
</script>
