---
import { Picture } from 'astro:assets';
import type { Elements } from '~/components/hero/Hero.astro';
import ArtDirection from '~/components/images/ArtDirection.astro';

interface Props {
    elements?: Elements;
}

const { elements } = Astro.props;
const { visual, cover, copy } = elements as Elements;
---

{
    cover && (
        <div class="absolute inset-0 h-full w-full">
            <ArtDirection
                src={cover.src}
                artDirectives={cover.artDirectives}
                alt={cover.alt}
                loading="eager"
                class:list={[
                    'h-full w-full',
                    cover.class ?? 'object-cover object-bottom',
                ]}
            />
        </div>
    )
}

<div
    class="relative container mx-auto grid grid-cols-1 items-stretch gap-fluid-s md:h-svh md:grid-cols-(--gtc-block50) md:not-dynamic:h-screen"
>
    <div class:list={['w-full', copy?.cell ?? 'self-center pt-safe-top']}>
        <slot />
    </div>

    {
        visual && (
            <div class:list={[visual?.cell ?? 'relative min-h-0']}>
                <Picture
                    src={visual.src as ImageMetadata}
                    densities={visual.densities ?? [1.5, 2]}
                    width={visual.width ?? 600}
                    alt={visual.alt}
                    loading="eager"
                    class:list={[
                        'h-full max-h-full w-full',
                        visual.class ?? 'object-contain object-bottom',
                    ]}
                    {...(visual.filter && {
                        style: { filter: `url(#${visual.filter})` },
                        'data-animate': visual.filter,
                    })}
                />
            </div>
        )
    }
</div>
<script>
    import { inView, animate, stagger, type AnimationSequence } from 'motion';

    const easeOverShoot = [0.16, 1, 0.3, 1] as const;
    const easeGentle = [0.22, 1, 0.36, 1] as const;

    const SEQUENCES = {
        none: [] as AnimationSequence,

        minimal: [
            [
                '[data-animate]',
                { opacity: [0, 1], x: [60, 0] },
                { duration: 0.8, delay: stagger(0.15) },
            ],
        ] as AnimationSequence,

        'slide-only': [
            [
                '[data-animate]',
                { opacity: [0, 1], x: [100, 0] },
                {
                    duration: 1.1,
                    delay: stagger(0.2),
                    ease: easeGentle,
                },
            ],
        ] as AnimationSequence,

        glitch: [
            [
                '[data-animate="turnIn"]',
                {
                    opacity: [0, 1],
                    transform: [
                        'perspective(200px) rotateY(25deg) translate(15%)',
                        'perspective(200px) rotateY(0deg) translate(0)',
                    ],
                },
                { duration: 0.25, delay: stagger(0.15) },
            ],
            [
                '[data-animate="rgb-split"]',
                { opacity: [0, 1] },
                { duration: 0.75 },
            ],
            ['#red-offset', { dx: [16, 3] }, { duration: 0.25, at: '<' }],
            [
                '#cyan-offset',
                { dx: [-16, -3] },
                {
                    duration: 0.75,
                    at: '<',
                },
            ],
            [
                '[data-animate="slideInRight"]',
                {
                    opacity: [0, 1],
                    x: ['-5%', '0'],
                },
                { duration: 0.25, delay: stagger(0.25) },
            ],
        ] as AnimationSequence,

        heroic: [
            [
                '[data-animate]',
                { opacity: 0, y: 80, scale: 0.88 },
                { duration: 0 },
            ],
            [
                '[data-animate]',
                { opacity: 1, y: 0, scale: 1 },
                {
                    duration: 1.4,
                    delay: stagger(0.12),
                    ease: easeGentle,
                },
            ],
        ] as AnimationSequence,

        default: [
            [
                '[data-animate="turnIn"]',
                {
                    opacity: [0, 1],
                    transform: [
                        'perspective(200px) rotateY(25deg) translate(15%)',
                        'perspective(200px) rotateY(0deg) translate(0)',
                    ],
                },
                { duration: 0.25, delay: stagger(0.15) },
            ],
            [
                '[data-animate="slideInRight"]',
                {
                    opacity: [0, 1],
                    transform: ['translateX(5%)', 'translateX(0%)'],
                },
                { duration: 0.75, delay: stagger(0.25) },
            ],
        ] as AnimationSequence,
    };

    inView(
        '#hero',
        (element) => {
            const name = element.getAttribute('data-sequence') || 'default';
            const sequence =
                SEQUENCES[name as keyof typeof SEQUENCES] ?? SEQUENCES.default;

            if (sequence.length) {
                const controls = animate(sequence);
                // return () => {
                //     console.log('exit hero');
                //     // animate(
                //     //     element.querySelectorAll('[data-animate]'),
                //     //     { opacity: 1 },
                //     //     { duration: 0.25 }
                //     // );
                // };
            }
        },
        { amount: 0.3 }
    );
</script>
