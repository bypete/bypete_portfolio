---
import { type CollectionEntry, getCollection, render } from 'astro:content';
import { formatBlogPosts } from '~/js/utils';
import WorkLayout from '~/layouts/WorkLayout.astro';

export async function getStaticPaths() {
    const posts = await getCollection('work');

    const formattedPosts = formatBlogPosts(posts, {
        filterOutDrafts: true,
        filterOutFuturePosts: true,
        sortByDate: true,
        limit: undefined,
    });

    const numberOfPosts = formattedPosts.length;

    if (numberOfPosts === 0) return [];

    return formattedPosts.map((post, index) => {
        return {
            params: { id: post.id },
            props: {
                post,
                prevPost:
                    formattedPosts[
                        index - 1 < 0 ? numberOfPosts - 1 : index - 1
                    ],
                nextPost:
                    formattedPosts[index + 1 >= numberOfPosts ? 0 : index + 1],
            },
        };
    });
}

type Props = {
    post: CollectionEntry<'work'>;
    prevPost: CollectionEntry<'work'>;
    nextPost: CollectionEntry<'work'>;
};

const { post, prevPost, nextPost } = Astro.props;
const { Content, headings } = await render(post);
---

<WorkLayout
    {post}
    frontmatter={post.data}
    section={post.collection}
    {headings}
    {prevPost}
    {nextPost}
>
    <Content />
</WorkLayout>
