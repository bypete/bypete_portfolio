---
import { type CollectionEntry, getCollection } from 'astro:content';
import MarkdownWorkLayout from '~/layouts/MarkdownWorkLayout.astro';
import { formatBlogPosts } from '~/js/utils';

export async function getStaticPaths() {
    const workEntries = await getCollection('work');
    const numberOfPosts = workEntries?.length;

    const formattedPosts = formatBlogPosts(workEntries, {
        filterOutDrafts: true,
        filterOutFuturePosts: true,
        sortByDate: true,
    });

    return formattedPosts.map((entry, i) => ({
        params: { slug: entry.slug },
        props: {
            entry,
            prevPost: i + 1 !== numberOfPosts ? formattedPosts[i + 1] : null,
            nextPost: i !== 0 ? formattedPosts[i - 1] : null,
        },
    }));
}

type Props = {
    entry: CollectionEntry<'work'>;
    prevPost: CollectionEntry<'work'>;
    nextPost: CollectionEntry<'work'>;
};

const { entry, prevPost, nextPost } = Astro.props;
const { Content, headings, remarkPluginFrontmatter } = await entry.render();
---

<MarkdownWorkLayout
    frontmatter={entry.data}
    section={entry.collection}
    minutesRead={remarkPluginFrontmatter.minutesRead}
    {headings}
    {prevPost}
    {nextPost}
>
    <Content />
</MarkdownWorkLayout>
